<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yapay Zeka Destekli Sınav & İtalya Rehberi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .nav-link { transition: all 0.3s; }
        .nav-link.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        .nav-link:not(.active) { border-bottom-color: transparent; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 350px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 400px; } }
        section {
            padding-top: 80px;
            margin-top: -64px;
            min-height: 90vh;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .markdown-content h3 { font-size: 1.25rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.25rem;}
        .markdown-content h4 { font-size: 1.1rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
        .markdown-content ul { list-style-type: disc; padding-left: 1.5rem; margin-left: 1rem; }
        .vocab-word { cursor: pointer; transition: all 0.2s; }
        .vocab-word.memorized { text-decoration: line-through; color: #16a34a; opacity: 0.6; }
        .level-accordion-header { cursor: pointer; }
        .level-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-lg md:text-xl font-bold text-slate-900">Kapsamlı Sınav & İtalya Rehberi</h1>
                <nav class="hidden lg:flex space-x-3">
                    <a href="#genel-bakis" class="nav-link py-2 px-2 border-b-2 font-medium text-slate-600 hover:text-blue-500 text-sm">Sınavlara Bakış</a>
                    <a href="#mufredat" class="nav-link py-2 px-2 border-b-2 font-medium text-slate-600 hover:text-blue-500 text-sm">Akademik Hazırlık</a>
                    <a href="#diller" class="nav-link py-2 px-2 border-b-2 font-medium text-slate-600 hover:text-blue-500 text-sm">Dil Okulu</a>
                    <a href="#yasam" class="nav-link py-2 px-2 border-b-2 font-medium text-slate-600 hover:text-blue-500 text-sm">Yaşam & Strateji</a>
                    <a href="#planlar" class="nav-link py-2 px-2 border-b-2 font-medium text-slate-600 hover:text-blue-500 text-sm">Planlar</a>
                    <a href="#yol-haritasi" class="nav-link py-2 px-2 border-b-2 font-medium text-slate-600 hover:text-blue-500 text-sm">İtalya Başvuru Portalı</a>
                </nav>
                <button id="mobile-menu-button" class="lg:hidden p-2 rounded-md text-slate-600 hover:bg-slate-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden lg:hidden">
            <a href="#genel-bakis" class="nav-link block py-2 px-4 text-sm hover:bg-slate-100">Sınavlara Bakış</a>
            <a href="#mufredat" class="nav-link block py-2 px-4 text-sm hover:bg-slate-100">Akademik Hazırlık</a>
            <a href="#diller" class="nav-link block py-2 px-4 text-sm hover:bg-slate-100">Dil Okulu</a>
            <a href="#yasam" class="nav-link block py-2 px-4 text-sm hover:bg-slate-100">Yaşam & Strateji</a>
            <a href="#planlar" class="nav-link block py-2 px-4 text-sm hover:bg-slate-100">Planlar</a>
            <a href="#yol-haritasi" class="nav-link block py-2 px-4 text-sm hover:bg-slate-100">İtalya Başvuru Portalı</a>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <section id="genel-bakis">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Sınavlara Genel Bakış</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">YKS ve TOLC-I sınavlarının temel yapılarını, felsefelerini ve puanlama sistemlerini yan yana karşılaştırın.</p>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-blue-600">YKS (Yükseköğretim Kurumları Sınavı)</h3>
                    <div class="space-y-4 text-slate-700">
                        <p><strong class="font-semibold">Felsefe:</strong> Türkiye'deki üniversitelere girişte kullanılan, milyonlarca adayın yarıştığı, sıralama ve eleme odaklı, oldukça rekabetçi bir sınav sistemidir.</p>
                        <div>
                            <strong class="font-semibold">Puanlama:</strong>
                            <ul class="list-disc list-inside mt-1 space-y-1">
                                <li>Yerleştirme Puanı: <span class="font-mono bg-slate-100 px-2 py-1 rounded-md">%40 TYT + %60 AYT</span></li>
                                <li>Net Hesaplama: 4 yanlış cevap, 1 doğru cevabı siler.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-green-600">TOLC-I (Test OnLine CISIA per Ingegneria)</h3>
                    <div class="space-y-4 text-slate-700">
                        <p><strong class="font-semibold">Felsefe:</strong> İtalya'daki mühendislik ve teknik programlara girişte kullanılan, adayın temel yetkinliklerini ölçen bir yeterlilik ve sıralama sınavıdır.</p>
                         <div>
                            <strong class="font-semibold">Puanlama:</strong>
                            <ul class="list-disc list-inside mt-1 space-y-1">
                                <li>Doğru Cevap: <span class="font-mono bg-green-100 text-green-800 px-2 py-1 rounded-md">+1 puan</span></li>
                                <li>Yanlış Cevap: <span class="font-mono bg-red-100 text-red-800 px-2 py-1 rounded-md">-0.25 puan</span></li>
                                <li>Boş Cevap: <span class="font-mono bg-slate-100 px-2 py-1 rounded-md">0 puan</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-12 bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <h3 class="text-2xl font-bold mb-4 text-center text-slate-900">Soru Başına Düşen Süre Karşılaştırması</h3>
                <p class="text-center text-slate-600 mb-6">Sınavların gerektirdiği farklı tempoları ve zaman yönetimi stratejilerini görsel olarak inceleyin.</p>
                <div class="chart-container">
                    <canvas id="timePerQuestionChart"></canvas>
                </div>
            </div>
        </section>
                <section id="mufredat">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Akademik Hazırlık</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Aşağıdan bir ders seçin ve öğrenmek istediğiniz konunun kartına tıklayarak yapay zeka destekli kaynaklara ulaşın!</p>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <div class="flex flex-col sm:flex-row items-center justify-between mb-6 gap-4">
                    <label for="subject-select" class="font-semibold text-lg">Ders Seçin:</label>
                    <select id="subject-select" class="w-full sm:w-auto p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="matematik">Matematik</option>
                        <option value="fizik">Fizik</option>
                        <option value="kimya">Kimya</option>
                        <option value="ingilizce">İngilizce</option>
                    </select>
                </div>
                <div id="curriculum-container">
                    <!-- Curriculum content will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <section id="diller">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">AI Dil Okulu</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">İngilizce ve İtalyanca becerilerinizi yapay zeka ile geliştirin.</p>
            </div>
             <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-rose-600">İngilizce (IELTS/TOEFL) Hazırlık</h3>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-lg">Writing Pratiği</h4>
                            <p class="text-sm text-slate-600 mb-2">Essay konunuzu girin, metninizi yazın ve yapay zekadan anında geri bildirim alın.</p>
                            <input type="text" id="essay-topic" class="w-full p-2 mb-2 rounded-md border-slate-300" placeholder="Essay Konusu (örn: The importance of space exploration)">
                            <textarea id="essay-text" class="w-full p-2 rounded-md border-slate-300" rows="5" placeholder="Yazdığınız essay metnini buraya yapıştırın..."></textarea>
                            <button id="analyze-essay-btn" class="w-full mt-2 bg-rose-500 text-white font-bold py-2 px-4 rounded-md hover:bg-rose-600">Essay'i Analiz Et</button>
                            <div id="essay-analysis-container" class="mt-3"></div>
                        </div>
                         <hr>
                        <div>
                            <h4 class="font-semibold text-lg">Speaking Pratiği</h4>
                            <p class="text-sm text-slate-600 mb-2">Aşağıdaki butona tıklayarak rastgele bir mülakat sorusu oluşturun ve cevaplamaya çalışın.</p>
                             <button id="generate-speaking-prompt-btn" class="w-full bg-rose-500 text-white font-bold py-2 px-4 rounded-md hover:bg-rose-600">Rastgele Konuşma Sorusu Oluştur</button>
                             <div id="speaking-prompt-container" class="mt-3"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-emerald-600">Temel İtalyanca Pratiği</h3>
                     <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-lg">Günlük Diyaloglar</h4>
                            <p class="text-sm text-slate-600 mb-2">Bir senaryo seçin ve yapay zeka ile sohbet ederek İtalyanca pratiği yapın.</p>
                            <select id="italian-scenario" class="w-full p-2 mb-2 rounded-md border-slate-300">
                                <option>Bir kafede kahve sipariş etme</option>
                                <option>Yol tarifi sorma</option>
                                <option>Biriyle tanışma ve selamlaşma</option>
                                <option>Pazarda alışveriş yapma</option>
                            </select>
                            <button id="generate-dialogue-btn" class="w-full bg-emerald-500 text-white font-bold py-2 px-4 rounded-md hover:bg-emerald-600">Diyalog Oluştur</button>
                             <div id="dialogue-container" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="yasam">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Kişisel Başarı ve Sağlık Koçu</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Sınav maratonunda zihinsel ve bedensel sağlığınızı korumak için AI destekli araçlar.</p>
            </div>
             <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-teal-600">AI Diyetisyen</h3>
                     <p class="text-sm text-slate-600 mb-4">Sınav döneminde enerjinizi yüksek tutacak ve kilo kontrolü sağlayacak sağlıklı menüler oluşturun.</p>
                     <button id="generate-diet-btn" class="w-full bg-teal-500 text-white font-bold py-2 px-4 rounded-md hover:bg-teal-600">Bugünkü Sağlıklı Menümü Oluştur</button>
                     <div id="diet-container" class="mt-4"></div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-sky-600">AI Stres Yönetimi Koçu</h3>
                    <p class="text-sm text-slate-600 mb-4">Yoğun tempoda bunaldığınızda 5 dakikalık bir mola vererek zihninizi dinlendirin.</p>
                    <button id="generate-meditation-btn" class="w-full bg-sky-500 text-white font-bold py-2 px-4 rounded-md hover:bg-sky-600">5 Dakikalık Meditasyon Başlat</button>
                    <div id="meditation-container" class="mt-4"></div>
                </div>
             </div>
        </section>
                <section id="planlar">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Sınav Takvimleri & Kişisel Planlar</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Türkiye ve İtalya'daki sınav takvimini ve kendi haftalık/aylık planınızı takip edin.</p>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-blue-600">YKS Takvimi</h3>
                    <ul id="yks-schedule-list" class="list-disc pl-5 space-y-2 text-slate-700"></ul>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-green-600">TOLC-I Takvimi</h3>
                    <ul id="tolci-schedule-list" class="list-disc pl-5 space-y-2 text-slate-700"></ul>
                </div>
            </div>
            <div class="bg-white p-6 mt-10 rounded-lg shadow-sm border border-slate-200">
                <h3 class="text-2xl font-bold mb-4 text-center text-slate-900">Kişisel Haftalık & Aylık Planlayıcı</h3>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-semibold text-lg text-blue-700 mb-2">Haftalık Hedefler</h4>
                        <textarea id="weekly-goals" class="w-full p-2 border border-slate-300 rounded-md mb-2" rows="4" placeholder="Bu hafta neler başarmak istiyorsun?"></textarea>
                        <button id="save-weekly-goals" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 w-full">Kaydet</button>
                        <div id="weekly-goals-list" class="mt-2"></div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-green-700 mb-2">Aylık Hedefler</h4>
                        <textarea id="monthly-goals" class="w-full p-2 border border-slate-300 rounded-md mb-2" rows="4" placeholder="Bu ay neleri başarmak istiyorsun?"></textarea>
                        <button id="save-monthly-goals" class="bg-green-500 text-white font-bold py-2 px-4 rounded-md hover:bg-green-600 w-full">Kaydet</button>
                        <div id="monthly-goals-list" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="yol-haritasi">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">İtalya Başvuru Portalı & Yol Haritası</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">İtalya'da üniversiteye başvuru sürecini adım adım keşfedin ve akıllı rehberden destek alın.</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 markdown-content">
                <h3>Başvuru Süreci Adımları</h3>
                <ul>
                    <li>Başvuru yapılacak üniversite ve programı seçin.</li>
                    <li>Gerekli belgeleri ve başvuru koşullarını araştırın.</li>
                    <li>Çevrimiçi başvuru portalına kaydolun.</li>
                    <li>Sınav ve dil yeterlilik belgelerini hazırlayın.</li>
                    <li>Başvurunuzu tamamlayın ve takibini yapın.</li>
                </ul>
                <h4 class="mt-6">AI Destekli Akıllı Rehber</h4>
                <div class="space-y-3">
                    <input type="text" id="italy-question" class="w-full p-2 border border-slate-300 rounded-md" placeholder="Başvuru süreciyle ilgili merak ettiğinizi yazın...">
                    <button id="ask-italy-ai-btn" class="w-full bg-indigo-500 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-600">Soruyu Sor</button>
                    <div id="italy-ai-answer" class="mt-3"></div>
                </div>
            </div>
        </section>

        <section id="kelime-kartlari">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">İngilizce & İtalyanca Kelime Kartları</h2>
                <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Her seviyeye uygun kelimelerle kelime bilginizi geliştirin. Hafıza için üstüne tıklayın!</p>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-rose-600">İngilizce Kelimeler</h3>
                    <div>
                        <label for="english-level-select" class="font-semibold">Seviye Seçin:</label>
                        <select id="english-level-select" class="w-full p-2 border border-slate-300 rounded-md mb-4">
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                        </select>
                        <div id="english-vocab-list" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-2xl font-bold mb-4 text-emerald-600">İtalyanca Kelimeler</h3>
                    <div>
                        <label for="italian-level-select" class="font-semibold">Seviye Seçin:</label>
                        <select id="italian-level-select" class="w-full p-2 border border-slate-300 rounded-md mb-4">
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                        </select>
                        <div id="italian-vocab-list" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-white border-t border-slate-200 py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-slate-500 text-sm">
            2025 &copy; Yapay Zeka Destekli Sınav ve İtalya Rehberi — Tüm Hakları Saklıdır.
        </div>
    </footer>
    <script>
document.addEventListener('DOMContentLoaded', function () {
    // ---------- Veriler ----------
    const curriculumData = {
        matematik: [
            { title: "Temel Kavramlar", aiPrompt: "Matematikte temel kavramlar konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." },
            { title: "Sayılar", aiPrompt: "Matematikte sayılar konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." },
            { title: "Denklemler", aiPrompt: "Matematikte denklemler konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." },
            { title: "Fonksiyonlar", aiPrompt: "Matematikte fonksiyonlar konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." }
        ],
        fizik: [
            { title: "Hareket", aiPrompt: "Fizikte hareket konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." },
            { title: "Kuvvet", aiPrompt: "Fizikte kuvvet konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." },
            { title: "Enerji", aiPrompt: "Fizikte enerji konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." }
        ],
        kimya: [
            { title: "Atomun Yapısı", aiPrompt: "Kimyada atomun yapısı konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." },
            { title: "Periyodik Sistem", aiPrompt: "Kimyada periyodik sistem konusu için kısa ve öz bir konu özeti, ardından 5 temel seviye test sorusu ve çözümleri hazırla." }
        ],
        ingilizce: [
            { title: "Present Simple", aiPrompt: "İngilizcede Present Simple zamanı için kısa bir özet ve 5 örnek cümle hazırla." },
            { title: "Past Simple", aiPrompt: "İngilizcede Past Simple zamanı için kısa bir özet ve 5 örnek cümle hazırla." }
        ]
    };

    const vocabularyData = {
        english: {
            A1: ["apple", "book", "cat", "dog", "egg", "fish", "girl", "house", "ice", "juice"],
            A2: ["always", "beautiful", "change", "dangerous", "enough", "famous", "giraffe", "healthy", "invite", "jungle"],
            B1: ["ambitious", "benefit", "compete", "decision", "effective", "frequently", "genuine", "hesitate", "ignore", "justice"],
            B2: ["acquire", "bizarre", "consequence", "devote", "emphasize", "fundamental", "gratitude", "hypothesis", "inevitable", "jeopardize"]
        },
        italian: {
            A1: ["ciao", "grazie", "pane", "acqua", "libro", "cane", "gatto", "sole", "scuola", "amico"],
            A2: ["sempre", "bello", "cambiare", "pericoloso", "abbastanza", "famoso", "giraffa", "sano", "invitare", "giungla"],
            B1: ["ambizioso", "beneficio", "competere", "decisione", "efficace", "frequentemente", "genuino", "esitare", "ignorare", "giustizia"],
            B2: ["acquisire", "bizzarro", "conseguenza", "dedicare", "enfatizzare", "fondamentale", "gratitudine", "ipotesi", "inevitabile", "mettere a rischio"]
        }
    };

    const yksScheduleData = [
        "Başvuru Tarihi: Şubat-Mart",
        "Sınav: Haziran başı",
        "Sonuç Açıklanma: Temmuz başı",
        "Tercih Dönemi: Temmuz sonu - Ağustos başı"
    ];
    const tolciScheduleData = [
        "Başvuru: Ocak-Mart",
        "Online Sınavlar: Şubat-Mayıs (her ay birkaç oturum)",
        "Sonuçlar: Sınavdan hemen sonra",
        "Üniversite Başvurusu: Haziran-Temmuz"
    ];

    // ---------- YARDIMCI FONKSİYONLAR ----------
    function renderCurriculum(subject) {
        const container = document.getElementById('curriculum-container');
        container.innerHTML = '';
        curriculumData[subject].forEach((topic, idx) => {
            const card = document.createElement('div');
            card.className = "bg-slate-50 border border-slate-200 rounded-lg p-4 mb-4 shadow-sm";
            card.innerHTML = `
                <h4 class="font-bold text-lg mb-2">${topic.title}</h4>
                <button data-idx="${idx}" class="curriculum-ai-btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md">AI Kaynak Oluştur</button>
                <div class="curriculum-ai-result mt-3"></div>
            `;
            container.appendChild(card);
        });
    }

    function renderVocabularyList(lang, level) {
        const listId = lang === 'english' ? 'english-vocab-list' : 'italian-vocab-list';
        const vocabList = vocabularyData[lang][level] || [];
        const container = document.getElementById(listId);
        container.innerHTML = '';
        vocabList.forEach((word, idx) => {
            const span = document.createElement('span');
            span.className = "vocab-word inline-block bg-slate-100 px-3 py-1 rounded-lg cursor-pointer hover:bg-green-200";
            span.textContent = word;
            span.title = 'Ezberledim olarak işaretle';
            span.onclick = () => span.classList.toggle('memorized');
            container.appendChild(span);
        });
    }

    function renderSchedule(listId, data) {
        const ul = document.getElementById(listId);
        ul.innerHTML = '';
        data.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            ul.appendChild(li);
        });
    }

    function saveGoals(type, value) {
        localStorage.setItem(type, value);
        renderGoals(type);
    }
    function renderGoals(type) {
        const val = localStorage.getItem(type) || '';
        const el = document.getElementById(type + '-list');
        if (el) el.innerHTML = val ? `<div class="bg-slate-100 rounded-md p-3 mt-2">${val}</div>` : '';
    }

    // ---------- CHART ----------
    new Chart(document.getElementById('timePerQuestionChart'), {
        type: 'bar',
        data: {
            labels: ['YKS (TYT)', 'YKS (AYT)', 'TOLC-I'],
            datasets: [{
                label: 'Soru başına süre (saniye)',
                data: [74, 90, 125],
                backgroundColor: ['#3b82f6', '#6366f1', '#22c55e']
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Süre (sn)' } }
            }
        }
    });

    // ---------- EVENTLER ----------

    // Menü ve aktif linkler
    function setActiveNav() {
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        let hash = window.location.hash || '#genel-bakis';
        let found = false;
        document.querySelectorAll('.nav-link').forEach(link => {
            if (link.getAttribute('href') === hash) {
                link.classList.add('active');
                found = true;
            }
        });
        if (!found) document.querySelector('.nav-link').classList.add('active');
    }
    setActiveNav();
    window.addEventListener('hashchange', setActiveNav);

    // Mobil menü
    document.getElementById('mobile-menu-button').onclick = () =>
        document.getElementById('mobile-menu').classList.toggle('hidden');

    // Müfredat render + ders seçme
    const subjectSelect = document.getElementById('subject-select');
    renderCurriculum(subjectSelect.value);
    subjectSelect.addEventListener('change', e => renderCurriculum(e.target.value));

    // Curriculum AI
    document.getElementById('curriculum-container').onclick = async function (e) {
        if (e.target.classList.contains('curriculum-ai-btn')) {
            const idx = e.target.getAttribute('data-idx');
            const subject = subjectSelect.value;
            const aiPrompt = curriculumData[subject][idx].aiPrompt;
            const resultDiv = e.target.nextElementSibling;
            resultDiv.innerHTML = '<div class="loader mx-auto my-4"></div>';
            const aiResult = await callGemini(aiPrompt);
            resultDiv.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2 markdown-content">${marked.parse(aiResult)}</div>`;
        }
    };

    // Vocabulary kartları
    document.getElementById('english-level-select').addEventListener('change', e =>
        renderVocabularyList('english', e.target.value));
    document.getElementById('italian-level-select').addEventListener('change', e =>
        renderVocabularyList('italian', e.target.value));
    renderVocabularyList('english', 'A1');
    renderVocabularyList('italian', 'A1');

    // Sınav takvimleri
    renderSchedule('yks-schedule-list', yksScheduleData);
    renderSchedule('tolci-schedule-list', tolciScheduleData);

    // Planlayıcı
    ['weekly', 'monthly'].forEach(type => {
        renderGoals(type + '-goals');
        document.getElementById('save-' + type + '-goals').onclick = () => {
            const val = document.getElementById(type + '-goals').value;
            saveGoals(type + '-goals', val);
        };
    });

    // --------- AI Fonksiyonları ---------
    // Gemini API ile iletişim
    async function callGemini(prompt) {
        const apiKey = "AIzaSyBloRGu97cJQpOjo8d0yXX_xVWpFMzxjvc";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        const payload = { contents: [{ parts: [{ text: prompt }] }] };
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                } catch(e) {
                    errorData = { error: { message: response.statusText } };
                }
                const errorMessage = errorData?.error?.message ?? `Sunucu hatası: ${response.status}.`;
                throw new Error(errorMessage);
            }
            const data = await response.json();
            if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
                return data.candidates[0].content.parts[0].text;
            } else {
                throw new Error("API'den geçerli veya beklenen formatta bir yanıt alınamadı.");
            }
        } catch (error) {
            console.error("Gemini API çağrısı başarısız:", error);
            return `Bir sorun oluştu: ${error.message}`;
        }
    }

    // İngilizce Essay Analizi
    document.getElementById('analyze-essay-btn').onclick = async function () {
        const topic = document.getElementById('essay-topic').value.trim();
        const essay = document.getElementById('essay-text').value.trim();
        const container = document.getElementById('essay-analysis-container');
        if (!topic || !essay) {
            container.innerHTML = '<div class="text-red-600">Lütfen bir konu ve essay metni girin.</div>';
            return;
        }
        container.innerHTML = '<div class="loader mx-auto my-4"></div>';
        const prompt = `Aşağıda bir IELTS/TOEFL essay yazısı ve konusu var. Yazıya, IELTS/TOEFL writing kriterlerine göre kısa ama detaylı bir feedback (puanlandırma, güçlü ve zayıf yönler, geliştirme önerileriyle) ver. Essay konusu: "${topic}" Essay metni: ${essay}`;
        const aiResult = await callGemini(prompt);
        container.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2 markdown-content">${marked.parse(aiResult)}</div>`;
    };

    // İngilizce Speaking prompt
    document.getElementById('generate-speaking-prompt-btn').onclick = async function () {
        const container = document.getElementById('speaking-prompt-container');
        container.innerHTML = '<div class="loader mx-auto my-4"></div>';
        const prompt = "IELTS/TOEFL speaking sınavı için rastgele bir mülakat sorusu (Part 2 veya Part 3 gibi) üret.";
        const aiResult = await callGemini(prompt);
        container.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2">${aiResult}</div>`;
    };

    // İtalyanca Diyalog
    document.getElementById('generate-dialogue-btn').onclick = async function () {
        const scenario = document.getElementById('italian-scenario').value;
        const container = document.getElementById('dialogue-container');
        container.innerHTML = '<div class="loader mx-auto my-4"></div>';
        const prompt = `İtalyanca günlük konuşma pratiği için aşağıdaki senaryoda geçen iki kişilik kısa bir diyalog yaz (her replikte Türkçe çevirisiyle birlikte): "${scenario}"`;
        const aiResult = await callGemini(prompt);
        container.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2 markdown-content">${marked.parse(aiResult)}</div>`;
    };

    // AI Diyetisyen
    document.getElementById('generate-diet-btn').onclick = async function () {
        const container = document.getElementById('diet-container');
        container.innerHTML = '<div class="loader mx-auto my-4"></div>';
        const prompt = "YKS veya TOLC-I sınavına hazırlanan bir öğrenci için dengeli, sağlıklı ve ekonomik bir günlük menü öner. (kahvaltı, öğle, akşam, ara öğünler listelensin, açıklama kısa olsun)";
        const aiResult = await callGemini(prompt);
        container.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2">${marked.parse(aiResult)}</div>`;
    };

    // AI Meditasyon
    document.getElementById('generate-meditation-btn').onclick = async function () {
        const container = document.getElementById('meditation-container');
        container.innerHTML = '<div class="loader mx-auto my-4"></div>';
        const prompt = "Yoğun sınav hazırlığı yapan bir öğrenci için 5 dakikalık nefes ve gevşeme egzersizleri içeren bir rehber hazırla. (adım adım, sade, motive edici)";
        const aiResult = await callGemini(prompt);
        container.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2">${marked.parse(aiResult)}</div>`;
    };

    // İtalya rehberi AI
    document.getElementById('ask-italy-ai-btn').onclick = async function () {
        const input = document.getElementById('italy-question');
        const question = input.value.trim();
        const container = document.getElementById('italy-ai-answer');
        if (!question) {
            container.innerHTML = '<div class="text-red-600">Lütfen bir soru girin.</div>';
            return;
        }
        container.innerHTML = '<div class="loader mx-auto my-4"></div>';
        const prompt = `İtalya'da üniversiteye başvuru ve yerleşim hakkında şu soruya sade ve detaylı cevap ver: "${question}"`;
        const aiResult = await callGemini(prompt);
        container.innerHTML = `<div class="bg-white rounded-md border p-3 mt-2 markdown-content">${marked.parse(aiResult)}</div>`;
    };

});
</script>
<!-- Marked.js for Markdown rendering -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>
